<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><title>Michell Stuttgart</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta http-equiv="imagetoolbar" content="no"><meta http-equiv="pragma" content="cache"><meta http-equiv="cache-control" content="cache"><meta http-equiv="vary" content="content-language"><meta http-equiv="Cache-control" content="max-age=2592000, public"><meta http-equiv="content-style-type" content="text/css"><link rel="stylesheet" type="text/css" href="http://codigoavulso.com.br/theme/css/screen.min.css"><link rel="stylesheet" type="text/css" href="http://codigoavulso.com.br/theme/css/highlight.min.css"><link rel="stylesheet" type="text/css" href="http://codigoavulso.com.br/theme/css/custom.min.css"><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400"><link rel="publisher" href><link rel="apple-touch-startup-image" href="http://codigoavulso.com.br/theme/images/logo.png"><link type="text/plain" rel="socialmedia" href="http://codigoavulso.com.br/socialmedia.txt"><link rel="dns-prefetch" href="http://codigoavulso.com.br"><link rel="dns-prefetch" href="//www.gstatic.com"><link rel="dns-prefetch" href="//fonts.gstatic.com"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//accounts.google.com"><link rel="dns-prefetch" href="//ssl.google-analytics.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="dns-prefetch" href="//googleads.g.doubleclick.net"><link rel="dns-prefetch" href="//pagead2.googlesyndication.com"><link rel="dns-prefetch" href="//twemoji.maxcdn.com"><link rel="dns-prefetch" href="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><link rel="dns-prefetch" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400"><meta http-equiv="content-type" content="text/html;charset=utf-8"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="application-name" content="Michell Stuttgart"><meta name="msapplication-starturl" content="http:http://codigoavulso.com.br"><meta name="msapplication-tooltip" content="# sudo apt-get install faith hope love"><meta name="msapplication-window" content="width=1024;height=768"><meta name="msapplication-task" content="name=Michell Stuttgart;action-uri=http:http://codigoavulso.com.br;icon-uri=http://codigoavulso.com.br/theme/images/logo.png"><meta name="msapplication-TileImage" content="http://codigoavulso.com.br/theme/images/apple-touch-icon-144x144.png"><meta name="msapplication-TileColor" content="#1F1F21"><meta name="application-name" content="Michell Stuttgart"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="google-site-verification" content><meta name="alexaVerifyID" content><meta name="wot-verification" content><meta name="msvalidate.01" content><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="medium" content="mult"><meta name="adblock" content="disable"><meta name="rating" content="General"><meta name="resource-type" content="document"><meta name="revisit-after" content="1 days"><meta name="revisit" content="1"><meta name="robots" content="index,follow"><meta name="no-email-collection" content="http://www.unspam.com/noemailcollection/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@"><meta property="og:site_name" content="Michell Stuttgart"><meta property="og:locale" content="pt"><link rel="canonical" href="http://codigoavulso.com.br/gerando-relatorios-de-testes-com-coveralls.html"><meta property="og:type" content="article"><meta property="og:title" content="Gerando relatórios de testes com Coveralls"><meta property="og:url" content="gerando-relatorios-de-testes-com-coveralls.html"><meta property="og:description" content="Aprenda a gerar relatórios de testes para o seu projeto Python usando o módulo Coveralls."><meta property="article:published_time" content="quarta, maio 18, 2016"><meta name="twitter:title" content="Gerando relatórios de testes com Coveralls"><meta name="twitter:description" content="Aprenda a gerar relatórios de testes para o seu projeto Python usando o módulo Coveralls."><meta name="description" content="Aprenda a gerar relatórios de testes para o seu projeto Python usando o módulo Coveralls."><meta name="twitter:creator" content="@"><meta property="og:image" content="http://codigoavulso.com.br/theme/images/logo.png"><meta name="twitter:image" content="http://codigoavulso.com.br/theme/images/logo.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="300"><meta property="og:image:height" content="300"><meta property="article:section" content="Python"><meta property="article:tag" content="python"><meta property="article:tag" content="coveralls"><meta property="article:tag" content="coverage"><meta property="article:tag" content="relatório"><meta property="article:tag" content="test"><meta property="article:author" content="Michell Stuttgart"><link href="http://codigoavulso.com.br/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Michell Stuttgart RSS Feed"><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-75274475-1', 'auto');ga('send', 'pageview');var _qevents = _qevents || [];setTimeout(function() { window.onscroll = function() { window.onscroll = null;
        ga('send','event','Ajuste de Tasa de Rebote','Scroll despues de 5 segundos');}}, 5000);</script><script src="//twemoji.maxcdn.com/twemoji.min.js"></script></head><body class="post-template nav-closed" itemscope itemtype="http://schema.org/WebPage"><meta itemprop="name" content="Michell Stuttgart"><meta itemprop="url" content="http://codigoavulso.com.br"><meta itemprop="headline" content="Michell Stuttgart || # sudo apt-get install faith hope love"><meta itemprop="description about" content="Meu blog sobre tecnologia, livros, linux e outras nerdices."><meta itemprop="keywords" content><meta itemprop="inLanguage" content="pt"><nav class="nav"><h3 class="nav-title">Menu</h3><a href="#" class="nav-close"><span class="hidden">Close</span></a><ul role="menubar"><li class role="presentation"><a href="http://codigoavulso.com.br/index.html" title="Michell Stuttgart" itemprop="name" itemprop="significantLink">Home</a></li><li role="presentation"><a href="https://github.com/mstuttgart" title="Perfil Github" itemprop="name" itemprop="significantLink">Perfil Github</a></li><li role="presentation"><a href="https://www.linkedin.com/in/michellstut" title="Perfil Linkedin" itemprop="name" itemprop="significantLink">Perfil Linkedin</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/archives.html" title="Michell Stuttgart | Archives" itemprop="name" itemprop="significantLink">Arquivos</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/algoritmo.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">Algoritmo</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/c.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">C++</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/desenvolvimento.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">Desenvolvimento</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/livro.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">Livro</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/projetos.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">Projetos</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/python.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">Python</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/temas.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">Temas</a></li><li class role="presentation"><a href="http://codigoavulso.com.br/category/tutorial.html" title="Michell Stuttgart |" itemprop="name" itemprop="significantLink">Tutorial</a></li></ul><a class="subscribe-button icon-feed" href="http://codigoavulso.com.br/feeds/all.atom.xml" target="blank">Subscribe</a></nav><span class="nav-cover"></span> <div class="site-wrapper"><header class="main-header post-head" style="background-image: url('http://codigoavulso.com.br/images/back7.jpg');" itemscope itemtype="http://schema.org/WPHeader"><div class="vertical"><div class="main-header-content inner"><h1 class="page-title" itemprop="headline">Gerando relatórios de testes com Coveralls</h1><section class="post-meta"><time class="post-date" itemprop="datePublished" datetime="2016YYY-28M-%DD" style="text-decoration:none;color: #EEEEEE">quarta, maio 18, 2016</time> on <a href="tag/python.html" style="text-decoration:none;color: #EEEEEE">Python, </a><a href="tag/coveralls.html" style="text-decoration:none;color: #EEEEEE">Coveralls, </a><a href="tag/coverage.html" style="text-decoration:none;color: #EEEEEE">Coverage, </a><a href="tag/relatorio.html" style="text-decoration:none;color: #EEEEEE">Relatório, </a><a href="tag/test.html" style="text-decoration:none;color: #EEEEEE">Test</a> </section></div></div><nav class="main-nav overlay clearfix"><a class="blog-logo" href="http://codigoavulso.com.br/index.html" style="text-decoration:none;color: rgb(255, 255, 255)"><span class="back-button icon-arrow-left"></span><span class="word">HOME</span></a><a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a></nav><div class="vertical"><div class="main-header-content inner"></div></div></header><main id="content" class="content" role="main"><article class="post" itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost"><section class="post-content"><p>Na <a href="http://codigoavulso.com.br/python-com-unittest-travis-ci-coveralls-e-landscape-parte-3-de-4.html">terceira parte</a> do tutorial sobre <em>unittest</em>, vimos como utilizar o serviço <a href="https://coveralls.io/">Coveralls</a> para gerar relatórios sobre o testes do nosso projeto. Entretanto, uma "desvantagem" do serviço é que o processo de análise é iniciado apenas quando executarmos um <em>push</em> ou um <em>pull request</em>. Sendo assim, não seria interessante termos a liberdade de executar esses testes localmente?</p><p>Felizmente, os desenvolvedores do <a href="https://coveralls.io/">Coveralls</a> pensaram nisso e criaram um conjunto de comandos que nos permite executá-lo pelo terminal.</p><h3>Instalação</h3><p>Então, antes de iniciarmos, vamos a instalação do módulo, que pode ser feito pelo comando a seguir:</p><div class="highlight"><pre><span></span>pip install coveralls
</pre></div><p>Quando você instala o módulo, um <em>script</em> de linha de comando chamado <code>coverage</code> é adicionado ao diretório de <em>scripts</em> python no seu sistema. Para suportar diferentes versões do Python, o módulo vem com um conjunto de <em>scripts</em>. Então, para a versão 2.7 do Python, você pode utilizar o comando <code>coverage</code> ou <code>coverage2</code>. Para a versão 3, utilize <code>coverage3</code>.</p><h3>Gerando relatórios</h3><p>O comando usado para obtermos um relatório sobre os testes do nosso projeto é simples. No diretório do projeto, basta executar:</p><div class="highlight"><pre><span></span>coverage run --source<span class="o">=</span>nomedopacote setup.py <span class="nb">test</span>
</pre></div><p>o comando <code>run</code> irá coletar dados sobre nosso código fonte. No nosso caso, usaremos o repositorio que criamos para o tutorial anterior: <a href="https://github.com/mstuttgart/codigo-avulso-test-tutorial">codigo-avulso-test-tutorial</a>. Assim, o comando seria:</p><div class="highlight"><pre><span></span>coverage run --source<span class="o">=</span>codigo_avulso_test_tutorial setup.py <span class="nb">test</span>
</pre></div><p>Se você executar o comando <code>ls -la</code> no terminal, verá que um arquivo chamando <code>.coverage</code> foi criado. Esse arquivo contém algumas informações sobre o seu código. Vale alertar que para gerar os relatórios precisamos, obrigatoriamente, executar o comando acima, quando formos gerar o relatórios pela primeira vez ou quando o código sofrer alguma modificação.</p><p>Uma vez que o arquivo <code>.coverage</code> foi gerado, execute o seguinte comando:</p><div class="highlight"><pre><span></span>coverage report
</pre></div><p>Um relatório com a porcentagem de cobertura de testes (entre outras informações) de cada arquivo de código fonte será exibido no terminal.</p><div class="highlight"><pre><span></span>Name                                               Stmts   Miss  Cover
----------------------------------------------------------------------
codigo_avulso_test_tutorial/__init__.py                <span class="m">0</span>      <span class="m">0</span>   100%
codigo_avulso_test_tutorial/circulo.py                 <span class="m">9</span>      <span class="m">0</span>   100%
codigo_avulso_test_tutorial/figura_geometrica.py       <span class="m">5</span>      <span class="m">0</span>   100%
codigo_avulso_test_tutorial/quadrado.py                <span class="m">8</span>      <span class="m">0</span>   100%
----------------------------------------------------------------------
TOTAL                                                 <span class="m">22</span>      <span class="m">0</span>   100%
</pre></div><p>As colunas exibidas no relatório possuem informações interessantes. São elas:</p><ul><li>Stmts: indica o total de trechos do código que, segundo o Coveralls, devem ser testados.</li><li>Miss: coluna que indica quantos trechos do código ainda não estão sob testes.</li><li>Cover: talvez a coluna mais importante, ela indica a porcentagem de cobertura de testes do arquivo fonte.</li></ul><p>Em <code>TOTAL</code> temos a cobertura total de testes do nosso projeto. Nesse projeto em especial, temos 100% porque o mesmo possui pouco código e os códigos existentes são simples de testar. Entretanto, em projeto mais complexos, nem sempre é possível chegar nessa porcentagem, então vale a pena se focar em escrever testes para as partes mais críticas do seu código e conseguir uma porcentagem perto dos 80%, considerado pelo <code>Coveralls</code> como satisfatório.</p><h4>Gerando relatório em HTML</h4><p>Uma opção interessante é gerar o relatório em formato <code>html</code> com o comando:</p><div class="highlight"><pre><span></span>coverage html
</pre></div><p>Um diretório chamado <code>htmlcov</code> será criado no diretório do projeto. Dentro desse diretório existe um arquivo de nome <code>index.html</code>, que pode ser aberto no navegador.</p><p>Para o Google Chrome, usamos:</p><div class="highlight"><pre><span></span>google-chrome htmlcov/index.html
</pre></div><p>ou com o Firefox</p><div class="highlight"><pre><span></span>firefox htmlcov/index.html
</pre></div><p>Abaixo temos o <code>index.html</code> aberto. Nele podemos ver a lista dos arquivos que estão cobertos pelo <code>Coveralls</code>.</p><p><img alt src="images/mstuttgart/snapshot_41.png"></p><p>Vamos analisar os dados do arquivo <code>circulo.py</code>. Assim, temos as seguintes colunas:</p><ul><li><code>statements</code>: indica o total de trechos do código que, segundo o Coveralls, devem ser testadas. No caso do arquivo <code>circulo.py</code>, o valor da coluna é 9, indicando que existem 9 trechos do código quem devem estar sob teste.</li><li><code>missing</code>: coluna que indica quantos trechos do código ainda não estão sob testes.</li><li><code>excluded</code>: coluna que indica quantos trechos do código foram ignorados pelo Coveralls. Algumas vezes pode ser necessário excluir alguns trechos de código do relatório devido ao tipo de código nele contido ou porque você simplesmente não deseja que aquele trecho seja incluido no relatorio. Isso é feito através de um arquivo de configuração, visto mais adiante.</li><li><code>coverage</code>: indica a porcentagem de cobertura de testes do nosso código.</li></ul><p>Na imagem abaixo, logo após clicarmos em <code>codigo_avulso_test_tutorial/circulo.py</code>, podemos ver os pontos do código que devem ser testados.</p><p><img alt src="images/mstuttgart/snapshot_42.png"></p><p>Ao clicarmos nos três botões no cabeçalho da página:</p><p><img alt src="images/mstuttgart/snapshot_43.png"></p><p>A página irá destacar, respectivamente, os trechos cobertos por testes, trechos sem testes ou que foram excluídos do <code>Coveralls</code>.</p><h4>Gerando relatório em XML</h4><p>Os relatórios em XML podem ser facilmente gerados por:</p><div class="highlight"><pre><span></span>coverage xml
</pre></div><p>Um arquivo chamado <code>coverage.xml</code> será criado.</p><h4>Criando o arquivo coveragerc</h4><p>O arquivo <code>.coveragesrc</code> é usado para determinar parâmetros de funcionamento do comando <code>coverage</code>. Nele podemos incluir e excluir aquivos da analise do <code>Coveralls</code> entre outras configurações. Abaixo temos um exemplo de arquivo de configuração.</p><div class="highlight"><pre><span></span><span class="k">[run]</span>
<span class="na">source</span> <span class="o">=</span> <span class="s">codigo_avulso_test_tutorial</span>
<span class="na">omit</span> <span class="o">=</span><span class="s"></span>
<span class="s">    codigo_avulso_test_tutorial/__init__.py</span>
<span class="s">    codigo_avulso_test_tutorial/main.py</span>
</pre></div><p>Na configuração acima, vamos omitir da análise o arquivo <code>__init__.py</code> e um arquivo <code>main.py</code>. Indicamos o <em>source</em> que é onde o <code>Coveralls</code> deve executar a análise.</p><p>O arquivo de configuração ainda pode receber várias informações. Você pode ver mais delas <a href="http://coverage.readthedocs.io/en/latest/source.html#source">aqui</a>.</p><h3>Conclusão</h3><p>Neste tutorial vimos um pouco mais sobre o <code>Coveralls</code>. Evitei colocar as informações deste tutorial nos tutoriais anteriores a fim de simplificá-los. Você pode aprender mais sobre o módulo consultando sua documentação <a href="http://coverage.readthedocs.io/en/latest/index.html">aqui</a>.</p><p>É isso pessoal, obrigado pela leitura e até o próximo tutorial.</p></section><footer class="post-footer"><figure class="author-image"><a class="img" href="author/michell-stuttgart.html" style="background-image: url('https://lh3.googleusercontent.com/-2DmtcIOqPIc/VyPVyYGo09I/AAAAAAAAF58/VBWeR-ejVhECPk4YR6hiHuQJz_RzM_3mgCCo/s601/IMG-20141231-WA0004%2B1.jpg')"><span class="hidden">Michell Stuttgart's Picture</span></a></figure><section class="author"><h4><a href="author/michell-stuttgart.html">Michell Stuttgart</a></h4><p>Sou graduado em Engenharia da Computação pela Univerdade Federal de Itajubá (UNIFEI) e entusiasta da filosofia do software livre, contribuidor de diversos projetos Open Source (incluindo projetos próprios) e feliz usuário linux.</p><div class="author-meta"><span class="author-location icon-location">Brasil</span><span class="author-email icon-link"><a href="mailto:michellstut@gmail.com">email</a></span><span class="github-profile icon-link"><a href="https://github.com/mstuttgart">Github</a></span><span class="linkedin-profile icon-link"><a href="https://www.linkedin.com/in/michellstut">Linkedin</a></span></div></section><section class="share"><h4>Share this post</h4><a class="icon-twitter" href="https://twitter.com/share?text=Gerando%20relat%C3%B3rios%20de%20testes%20com%20Coveralls%20via%20%40&url=http://codigoavulso.com.br/gerando-relatorios-de-testes-com-coveralls.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><span class="hidden">Twitter</span></a><a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://codigoavulso.com.br/gerando-relatorios-de-testes-com-coveralls.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><span class="hidden">Facebook</span></a><a class="icon-google-plus" href="https://plus.google.com/share?url=http://codigoavulso.com.br/gerando-relatorios-de-testes-com-coveralls.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;"><span class="hidden">Google+</span></a></section><section><h2>Comments !</h2><div id="disqus_thread"></div><script type="text/javascript">var disqus_identifier = "gerando-relatorios-de-testes-com-coveralls.html";(function(){var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//codigoavulso.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></section> </footer></article></main><aside class="read-next"><a class="read-next-story prev" style="background-image: url('')" href="http://codigoavulso.com.br/python-com-unittest-travis-ci-coveralls-e-landscape-parte-4-de-4.html"><section class="post"><h2>Python com Unittest, Travis CI, Coveralls e Landscape (Parte 4 de 4)</h2><p><p>Na última parte do tutorial vamos apreder a utilizar o serviço Landscape, desde a inscrição no serviço, configuração e uso em nosso projeto.</p></p></section></a></aside> <footer class="site-footer clearfix" role="contentinfo" itemscope itemtype="http://schema.org/WPFooter"><section class="copyright"><a itemprop="url" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"> CC Attribution-NonCommercial-ShareAlike 4.0 International License</a>. </section><section class="poweredby"> Proudly published with <a itemprop="url" href="https://getpelican.org" target="_blank">Pelican</a></section></section></footer></div><script type="text/javascript" src="http://codigoavulso.com.br/theme/js/jquery-1.11.2.min.js"></script><script type="text/javascript" src="http://codigoavulso.com.br/theme/js/jquery.fitvids.min.js"></script><script type="text/javascript" src="http://codigoavulso.com.br/theme/js/index.min.js"></script><script>twemoji.parse(document, {"size":16});</script></body></html>